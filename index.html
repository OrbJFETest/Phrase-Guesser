<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Phrase Guesser</title>
  <style>
    :root {
      --bg: #f0f0f0;
      --fg: #333;
      --box-border: #444;
      --bar-bg: #888;
      --msg-wrong: #fdd;
      --msg-right: #dfd;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
      background-color: var(--bg);
      color: var(--fg);
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      --bg: #222;
      --fg: #eee;
      --box-border: #aaa;
      --bar-bg: #bbb;
      --msg-wrong: #600;
      --msg-right: #060;
    }
    h1 { margin-bottom: 0; }
    #hint { font-size: 18px; color: #666; margin-top: 5px; }

    #hiddenPhrase {
      display: flex; flex-wrap: wrap; justify-content: center;
      font-size: 32px; letter-spacing: 8px;
      margin: 20px auto; max-width: 600px; gap: 10px;
    }
    .char-box {
      border-bottom: 2px solid var(--box-border);
      width: 24px; height: 40px; line-height: 40px;
      text-transform: uppercase;
    }
    .space-box { border: none; width: 24px; }

    @keyframes shake {
      0%,100% { transform: translateX(0) }
      20%,60% { transform: translateX(-5px) }
      40%,80% { transform: translateX(5px) }
    }
    .shake { animation: shake 0.4s; }

    #message {
      font-size: 18px; margin-top: 20px;
      min-height: 1.2em;
      transition: background 0.3s;
    }

    button {
      margin: 10px 5px; padding: 10px 20px;
      font-size: 16px; cursor: pointer;
    }
    #controls { margin-bottom: 10px; }

    #resultsScreen {
      display: none; margin-top: 40px;
      background: #fff; border: 1px solid #ccc;
      padding: 20px; width: 320px;
      margin-left: auto; margin-right: auto;
    }
    body.dark #resultsScreen {
      background: #333; border-color: #555; color: #eee;
    }
    #resultsScreen .bar {
      background-color: var(--bar-bg);
      height: 20px; margin: 4px 0;
      text-align: left; color: white; padding-left: 5px;
      white-space: nowrap;
      min-width: 60px;
    }
    #resultsScreen p { margin: 6px 0; }
    #sharePanel { display: none; margin-top: 10px; }
    #shareText {
      width: 100%; height: 60px; resize: none;
      font-size: 14px; padding: 5px;
    }

    @media (max-width: 480px) {
      #hiddenPhrase { font-size: 24px; letter-spacing: 4px; }
      .char-box { width: 18px; height: 30px; line-height: 30px; }
    }
  </style>
</head>
<body>

  <h1>üî§ Phrase Guesser</h1>
  <div id="hint"></div>

  <div id="hiddenPhrase"></div>
  <div id="message"></div>

  <div id="controls">
    <button id="resetBtn">üîÑ Reset Game</button>
    <button id="themeToggle">üåì Toggle Theme</button>
  </div>

  <!-- hidden input to summon mobile keyboard -->
  <input id="hiddenInput" type="text" maxlength="1"
         style="position:absolute; top:0; left:0; width:1px; height:1px;
                opacity:0; pointer-events:none;"
         autocomplete="off" autocapitalize="none" autocorrect="off" />

  <div id="resultsScreen">
    <h2>Thanks for playing!</h2>
    <p><strong>Guesses:</strong> <span id="guessCountDisplay">0</span></p>
    <p><strong>Time:</strong> <span id="timeElapsed">0</span>s</p>
    <p id="badgeLine"></p>
    <p><strong>Games Played:</strong> <span id="gamesPlayed">0</span></p>
    <p><strong>Win %:</strong> <span id="winPercent">0</span></p>
    <p><strong>Current Streak:</strong> <span id="currentStreak">0</span></p>
    <p><strong>Max Streak:</strong> <span id="maxStreak">0</span></p>
    <p><strong>Guess Distribution:</strong></p>
    <div id="guessDist"></div>

    <div id="sharePanel">
      <p><strong>Share your result:</strong></p>
      <textarea id="shareText" readonly></textarea><br>
      <button id="copyShare">üìã Copy</button>
    </div>

    <button onclick="startNewGame()">üîÅ Play Again</button>
  </div>

  <script>
    const phrases = [
      { hint: "Unexpected Good Fortune",    text: "LUCKY BREAK" },
      /* ‚Ä¶ your other phrases ‚Ä¶ */
      { hint: "Found in a Toolbox",          text: "PHILLIPS SCREWDRIVER" }
    ];

    let revealed, revealedIndices, currentGuess, gameOver, phrase, hint;
    let guessCount = 0, startTime = 0;
    const stats = { played:0, wins:0, streak:0, maxStreak:0, dist:[0,0,0,0,0,0,0] };

    // DOM refs
    const hintDiv       = document.getElementById("hint"),
          phraseDiv     = document.getElementById("hiddenPhrase"),
          messageDiv    = document.getElementById("message"),
          resultsScreen = document.getElementById("resultsScreen"),
          gamesPlayed   = document.getElementById("gamesPlayed"),
          winPercent    = document.getElementById("winPercent"),
          currentStreak = document.getElementById("currentStreak"),
          maxStreak     = document.getElementById("maxStreak"),
          guessDist     = document.getElementById("guessDist"),
          guessCountDisp= document.getElementById("guessCountDisplay"),
          timeEl        = document.getElementById("timeElapsed"),
          badgeLine     = document.getElementById("badgeLine"),
          sharePanel    = document.getElementById("sharePanel"),
          shareText     = document.getElementById("shareText"),
          copyShare     = document.getElementById("copyShare"),
          resetBtn      = document.getElementById("resetBtn"),
          themeToggle   = document.getElementById("themeToggle"),
          hiddenInput   = document.getElementById("hiddenInput");

    resetBtn.addEventListener("click", startNewGame);
    themeToggle.addEventListener("click", () => document.body.classList.toggle("dark"));
    copyShare.addEventListener("click", () => {
      shareText.select();
      document.execCommand("copy");
    });

    // always keep the hidden input focused
    function focusInput() {
      hiddenInput.value = "";
      hiddenInput.focus();
    }
    document.addEventListener("touchend", focusInput);

    hiddenInput.addEventListener("input", e => {
      const letter = e.target.value.toUpperCase();
      e.target.value = "";
      if (/^[A-Z]$/.test(letter)) {
        for (let i = 0; i < currentGuess.length; i++) {
          if (phrase[i] !== " " && !currentGuess[i] && revealed[i] === "_") {
            currentGuess[i] = letter;
            break;
          }
        }
        renderPhrase();
      }
    });
    hiddenInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        submitGuess();
        e.preventDefault();
      }
    });

    function setupPhrase() {
      const chosen = phrases[Math.floor(Math.random()*phrases.length)];
      phrase = chosen.text;
      hint   = chosen.hint;
      revealed = Array.from(phrase).map(c=> c===" " ? " " : "_");
      revealedIndices = new Set();
      currentGuess = Array.from(phrase).map(c=> c===" " ? " " : "");
      gameOver = false;
      guessCount = 0;
      hintDiv.textContent = `Hint: ${hint}`;
      messageDiv.textContent = "";
      resultsScreen.style.display = "none";
      sharePanel.style.display = "none";
      startTime = Date.now();
      revealRandomLetter();
      renderPhrase();
      focusInput();
    }

    function renderPhrase() {
      phraseDiv.innerHTML = "";
      for (let i = 0; i < phrase.length; i++) {
        const span = document.createElement("span");
        span.className = phrase[i]===" " ? "space-box" : "char-box";
        span.textContent = revealed[i] !== "_" ? revealed[i] : (currentGuess[i]||"_");
        phraseDiv.appendChild(span);
      }
    }

    function revealLetter(letter) {
      let found = false;
      for (let i = 0; i < phrase.length; i++) {
        if (phrase[i] === letter && !revealedIndices.has(i)) {
          revealed[i] = letter;
          revealedIndices.add(i);
          currentGuess[i] = letter;
          found = true;
        }
      }
      return found;
    }

    function revealRandomLetter() {
      const rem = [];
      for (let i = 0; i < phrase.length; i++) {
        if (phrase[i] !== " " && !revealedIndices.has(i)) rem.push(phrase[i]);
      }
      if (rem.length) revealLetter(rem[Math.floor(Math.random()*rem.length)]);
    }

    function submitGuess() {
      if (gameOver) return;
      guessCount++;

      const guessStr = revealed
        .map((c,i) => c !== "_" ? c : currentGuess[i])
        .join("")
        .toUpperCase();

      if (guessStr === phrase) {
        gameOver = true;
        revealed = Array.from(phrase);
        messageDiv.textContent = "üéâ Correct!";
        messageDiv.style.background = "var(--msg-right)";
        handleStats(true);
        renderResults();
      } else {
        phraseDiv.classList.add("shake");
        setTimeout(()=> phraseDiv.classList.remove("shake"), 400);
        messageDiv.textContent = "‚ùå Incorrect.";
        messageDiv.style.background = "var(--msg-wrong)";
        revealRandomLetter();
        if (!revealed.includes("_")) {
          gameOver = true;
          messageDiv.textContent = "üòû You didn‚Äôt guess it!";
          handleStats(false);
          renderResults();
          return;
        }
        currentGuess = Array.from(phrase).map(c=> c===" " ? " " : "");
        renderPhrase();
      }
    }

    function handleStats(won) {
      stats.played++;
      if (won) {
        stats.wins++;
        stats.streak++;
        stats.maxStreak = Math.max(stats.maxStreak, stats.streak);
        const bucket = Math.min(guessCount, 6);
        stats.dist[bucket]++;
      } else {
        stats.streak = 0;
      }
    }

    function renderResults() {
      renderPhrase();
      guessCountDisp.textContent = guessCount;
      const elapsed = Math.round((Date.now() - startTime) / 1000);
      timeEl.textContent = elapsed;
      gamesPlayed.textContent = stats.played;
      winPercent.textContent = Math.round(stats.wins / stats.played * 100);
      currentStreak.textContent = stats.streak;
      maxStreak.textContent = stats.maxStreak;
      guessDist.innerHTML = stats.dist.slice(1)
        .map((v,i) => `<div class="bar" style="width:${v*10+20}px">${i+1}: ${v}</div>`)
        .join("");

      const badges = [];
      if (elapsed <= 10) badges.push("üèéÔ∏è Speedster!");
      if (stats.wins === stats.played) badges.push("üéØ Perfectionist!");
      badgeLine.textContent = badges.join(" ");

      const won = messageDiv.textContent.startsWith("üéâ");
      const resultText = won ? "I got" : "I didn't guess";
      shareText.value = `üî§ Phrase Guesser: ${won?"üéâ":"üòû"} ${resultText} ‚Äú${phrase}‚Äù in ${guessCount} guess${guessCount>1?"es":""} (${elapsed}s).`;
      sharePanel.style.display = "block";

      resultsScreen.style.display = "block";
      focusInput();
    }

    function startNewGame() {
      setupPhrase();
    }

    document.addEventListener("keydown", e => {
      if (gameOver) return;
      if (e.key === "Enter") {
        submitGuess();
        e.preventDefault();
      } else if (e.key === "Backspace") {
        for (let i = currentGuess.length - 1; i >= 0; i--) {
          if (phrase[i] !== " " && currentGuess[i]) {
            currentGuess[i] = "";
            break;
          }
        }
      } else if (/^[a-zA-Z]$/.test(e.key)) {
        for (let i = 0; i < currentGuess.length; i++) {
          if (phrase[i] !== " " && !currentGuess[i] && revealed[i] === "_") {
            currentGuess[i] = e.key.toUpperCase();
            break;
          }
        }
      }
      renderPhrase();
    });

    // initialize
    setupPhrase();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Phrase Game — Mobile Solve Fix</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #category, #hint, #bankroll, #message { margin: 10px 0; }
    #phrase {
      display: flex; justify-content: center; flex-wrap: wrap; gap: 8px;
      font-size: 2rem;
    }
    .letter-box {
      width: 1.2em; border-bottom: 2px solid #333;
      text-align: center; line-height: 1.2em;
    }
    .space-box {
      width: 1.2em; border: none;
    }
    .solve-input {
      width: 1.2em; border-bottom: 2px solid #333;
      text-align: center; font-size: 1rem;
      color: red; background: none; outline: none;
    }
    #keyboard {
      margin-top: 20px;
      display: grid; grid-template-columns: repeat(13, 1fr); gap: 5px;
    }
    .key {
      position: relative; padding: 10px 0 5px; background: #eee;
      cursor: pointer; user-select: none; border-radius: 4px;
      font-size: 1rem;
    }
    .key.disabled { background: #ccc; cursor: default; }
    .key.chosen  { opacity: 0.6; }
    .key .cost {
      position: absolute; top:2px; left:0; width:100%;
      font-size:0.8rem; color:green; text-align:center;
      pointer-events:none;
    }
    .key .letter { margin-top:1.2em; display:block; }
    #controls { margin:20px 0; }
    button { padding:8px 12px; margin:5px; }
    #submitSolutionBtn { display:none; }

    /* Modal */
    #endModal {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); display:flex;
      align-items:center; justify-content:center;
      visibility:hidden;
    }
    #endModal .modal-content {
      background:#fff; padding:20px; border-radius:8px;
      position:relative; box-shadow:0 4px 12px rgba(0,0,0,0.3);
      min-width:300px; text-align:center;
    }
    #endModal .close-btn {
      position:absolute; top:8px; right:12px;
      cursor:pointer; font-size:1.2rem; font-weight:bold;
    }
  </style>
</head>
<body>

  <h1>Wordle of Fortune</h1>
  <div id="category"></div>
  <div id="phrase"></div>

  <div id="controls">
    <button id="hintBtn">Reveal Hint (-$200)</button>
    <button id="solveModeBtn">Solve Puzzle</button>
    <button id="submitSolutionBtn">Submit Solution</button>
    <button id="resetBtn">New Phrase</button>
  </div>

  <div id="hint"></div>
  <div id="bankroll"></div>
  <div id="message"></div>
  <div id="keyboard"></div>

  <!-- End-of-round modal -->
  <div id="endModal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h2>Round Over</h2>
      <p id="modalMessage"></p>
      <p>Highest Cash Streak: <strong id="highestCash"></strong></p>
    </div>
  </div>

  <script>
    const phrases = [
  // 4-word phrases
  { category:"Proverb",               hint:"Something that seems bad at first but ends well",    phrase:"A BLESSING IN DISGUISE" },
  { category:"Idiomatic Expression",  hint:"Starting over after failure",                          phrase:"BACK TO SQUARE ONE" },
  { category:"Food Idiom",            hint:"Something very easy to accomplish",                     phrase:"A PIECE OF CAKE" },
  { category:"Quantity",              hint:"A very small, insignificant amount",                   phrase:"A DROP IN THE BUCKET" },
  { category:"Card-Game Idiom",       hint:"Keeping a secret advantage up your sleeve",            phrase:"ACE IN THE HOLE" },
  { category:"Proverb",               hint:"Making a bad situation even worse",                    phrase:"ADDING INSULT TO INJURY" },
  { category:"Nautical",              hint:"Everyone is needed to get the job done",               phrase:"ALL HANDS ON DECK" },
  { category:"Critique",              hint:"Big words but no actual follow-through",               phrase:"ALL TALK NO ACTION" },
  { category:"Expression",            hint:"Lost for words through shock or surprise",              phrase:"CAT GOT YOUR TONGUE" },
  { category:"Clarity",               hint:"As clear as a perfectly tuned bell",                    phrase:"CLEAR AS A BELL" },
  { category:"Expression",            hint:"Almost there, but not quite",                          phrase:"CLOSE BUT NO CIGAR" },
  { category:"Boxing",                hint:"Knocked out or completely beaten",                     phrase:"DOWN FOR THE COUNT" },
  { category:"Expression",            hint:"Don’t write me off until I’ve tried",                  phrase:"DON'T COUNT ME OUT" },
  { category:"Western",               hint:"Getting back into action after a break",               phrase:"BACK IN THE SADDLE" },
  { category:"Compliment",            hint:"An exceptionally great time",                          phrase:"A MIGHTY GOOD TIME" },

  // 5-word phrases
  { category:"Medicine",              hint:"Something unpleasant but necessary",                   phrase:"A BITTER PILL TO SWALLOW" },
  { category:"Weather",               hint:"A sudden, completely unexpected occurrence",           phrase:"A BOLT FROM THE BLUE" },
  { category:"Expression",            hint:"What would you do with my opinion?",                   phrase:"A PENNY FOR YOUR THOUGHTS" },
  { category:"Expression",            hint:"Holding onto anger or resentment",                     phrase:"A CHIP ON YOUR SHOULDER" },
  { category:"Weather",               hint:"Trouble looming just ahead",                           phrase:"A STORM ON THE HORIZON" },
  { category:"Leisure",               hint:"An extremely fun and memorable time",                  phrase:"A WHALE OF A TIME" },
  { category:"Proverb",               hint:"Time seems to crawl when you wait",                    phrase:"A WATCHED POT NEVER BOILS" },
  { category:"Chance",                hint:"Gambling with the unknown",                            phrase:"A ROLL OF THE DICE" },
  { category:"Romantic",              hint:"A perfect match made by fate",                         phrase:"A MATCH MADE IN HEAVEN" },
  { category:"Mood",                  hint:"Feeling listless or out of sorts",                     phrase:"A CASE OF THE BLAHS" },
  { category:"Visual",                hint:"Stunning to behold",                                   phrase:"A FEAST FOR THE EYES" },
  { category:"Visual",                hint:"A welcome sight after a long wait",                    phrase:"A SIGHT FOR SORE EYES" },
  { category:"Business",              hint:"Getting in on the action and profit",                  phrase:"A PIECE OF THE ACTION" },
  { category:"Probability",           hint:"Extremely unlikely to occur",                          phrase:"A GHOST OF A CHANCE" },
  { category:"Advice",                hint:"A tip to point you in the right direction",           phrase:"A FRIENDLY PIECE OF ADVICE" },

  // 6-word phrases
  { category:"Shopping",              hint:"A deal that’s almost too good to pass up",             phrase:"A BARGAIN AT HALF THE PRICE" },
  { category:"Value",                 hint:"Greater return on your spending",                      phrase:"A BIGGER BANG FOR YOUR BUCK" },
  { category:"Character",             hint:"Someone convinced they’re more important than others",  phrase:"A LEGEND IN HIS OWN MIND" },
  { category:"Royalty",               hint:"A meal fit for a king or queen",                       phrase:"A MEAL FIT FOR A KING" },
  { category:"Proverb",               hint:"Fix a small problem before it becomes huge",           phrase:"A STITCH IN TIME SAVES NINE" },
  { category:"Leisure",               hint:"An absolute blast from start to finish",               phrase:"A WHALE OF A GOOD TIME" },
  { category:"Love",                  hint:"Distance makes the heart grow fonder",                  phrase:"ABSENCE MAKES THE HEART GROW FONDER" },
  { category:"Reflection",            hint:"When it’s all been said and done",                     phrase:"AFTER ALL IS SAID AND DONE" },
  { category:"Planning",              hint:"Everything goes exactly as you mapped it out",         phrase:"ALL ACCORDING TO THE MASTER PLAN" },
  { category:"Etiquette",             hint:"Politeness goes a very long way",                      phrase:"ALWAYS SAY PLEASE AND THANK YOU" },

  // 7-word phrases
  { category:"Hierarchy",             hint:"A big name in a small setting",                        phrase:"A BIG FISH IN A SMALL POND" },
  { category:"Proverb",               hint:"Hard to locate someone of outstanding quality",        phrase:"A GOOD MAN IS HARD TO FIND" },
  { category:"Money",                 hint:"Saving just a little now can help later",              phrase:"A PENNY SAVED IS A PENNY EARNED" },
  { category:"Photography",           hint:"A single image can tell a thousand things",            phrase:"A PICTURE IS WORTH A THOUSAND WORDS" },
  { category:"Service",               hint:"Going well beyond what’s required",                    phrase:"ABOVE AND BEYOND THE CALL OF DUTY" },
  { category:"Slang",                 hint:"And as an extra, something unexpected",                phrase:"ALL THAT AND A BAG OF CHIPS" },
  { category:"Wish",                  hint:"May every one of your hopes come true",                phrase:"AND MAY ALL YOUR DREAMS COME TRUE" },
  { category:"Secret",                hint:"Accidentally let the cat run free",                    phrase:"LET THE CAT OUT OF THE BAG" },
  { category:"Warning",               hint:"Trying too much can backfire badly",                   phrase:"BITE OFF MORE THAN YOU CAN CHEW" },

  // Media titles

  // Movies (10 titles, 3–7 words, no apostrophes)
  { category:"Movie", hint:"Time-traveling teenager’s wild ride",                   phrase:"BACK TO THE FUTURE" },
  { category:"Movie", hint:"Civil War-era epic romance",                          phrase:"GONE WITH THE WIND" },
  { category:"Movie", hint:"Child lost in magical land of Oz",                    phrase:"THE WIZARD OF OZ" },
  { category:"Movie", hint:"Psychologist chases a serial killer",                phrase:"THE SILENCE OF THE LAMBS" },
  { category:"Movie", hint:"Navy crew battles giant sea creature",                phrase:"JAWS THE REVENGE" },
  { category:"Movie", hint:"Archaeologist races Nazis for sacred relic",          phrase:"RAIDERS OF THE LOST ARK" },
  { category:"Movie", hint:"Apocalypse survivor battles undead hordes",           phrase:"DAWN OF THE DEAD" },
  { category:"Movie", hint:"Creature emerges from a moonlit lagoon",              phrase:"THE CREATURE FROM THE BLACK LAGOON" },
  { category:"Movie", hint:"Patient rebels in a mental institution",              phrase:"ONE FLEW OVER THE CUCOOS NEST" },
  { category:"Movie", hint:"Scientist prevents an assassination to save tomorrow", phrase:"THE MAN WHO KNEW TOO MUCH" },

  // Books (10 titles, 3–7 words, no apostrophes)
  { category:"Book", hint:"Scout witnesses racial injustice in Depression South",    phrase:"TO KILL A MOCKINGBIRD" },
  { category:"Book", hint:"Family saga spanning generations in South America",     phrase:"ONE HUNDRED YEARS OF SOLITUDE" },
  { category:"Book", hint:"Revolutionary Paris at the turn of the century",       phrase:"A TALE OF TWO CITIES" },
  { category:"Book", hint:"Romance and social satire in Regency England",         phrase:"PRIDE AND PREJUDICE" },
  { category:"Book", hint:"Teen alienation in elite New York prep school",        phrase:"THE CATCHER IN THE RYE" },
  { category:"Book", hint:"Dust Bowl tragedy and migrant hardship",               phrase:"THE GRAPES OF WRATH" },
  { category:"Book", hint:"Dystopian world under total government control",       phrase:"BRAVE NEW WORLD" },
  { category:"Book", hint:"Crime and punishment in Tsarist Russia",               phrase:"A CLOCKWORK ORANGE" },
  { category:"Book", hint:"Children stranded uncover their own savagery",         phrase:"LORD OF THE FLIES" },
  { category:"Book", hint:"Symbologist races to solve Church mysteries",          phrase:"ANGELS AND DEMONS" },

  // TV Shows (10 titles, 3–7 words, no apostrophes)
  { category:"TV Show", hint:"Lawyer defends accused teen in racial trial",            phrase:"A TIME TO KILL" },  
  { category:"TV Show", hint:"Friends navigate life and love in New York",           phrase:"HOW I MET YOUR MOTHER" },
  { category:"TV Show", hint:"Community survives zombie apocalypse",                   phrase:"THE WALKING DEAD" },
  { category:"TV Show", hint:"Politician manipulates Washington power structures",    phrase:"HOUSE OF CARDS" },
  { category:"TV Show", hint:"Family sitcom set in suburban America",                 phrase:"EVERYBODY LOVES RAYMOND" },
  { category:"TV Show", hint:"Warring families vie for control of a realm",           phrase:"GAME OF THRONES" },
  { category:"TV Show", hint:"Geeks and scientists solve cosmic mysteries",            phrase:"THE BIG BANG THEORY" },
  { category:"TV Show", hint:"Detectives tackle sex crimes in New York",              phrase:"LAW AND ORDER SPECIAL VICTIMS UNIT" },
  { category:"TV Show", hint:"Woman navigates prison life and unlikely friendships",    phrase:"ORANGE IS THE NEW BLACK" },
  { category:"TV Show", hint:"Single women in Manhattan explore love and friendship",    phrase:"SEX AND THE CITY" }
];
    const letterCosts = {
      Q:30,W:50,E:140,R:120,T:120,Y:60,U:80,I:110,O:90,P:80,
      A:130,S:120,D:80,F:60,G:70,H:70,J:30,K:50,L:80,
      Z:40,X:40,C:80,V:50,B:60,N:100,M:70
    };

    let current, revealed, solveGuess, solveIndex, solveAttempts;
    const initialBankroll = 1000;
    let bankroll = initialBankroll, highestCash = 0;
    let solveMode = false;

    const categoryEl        = document.getElementById("category"),
          phraseEl          = document.getElementById("phrase"),
          hintEl            = document.getElementById("hint"),
          hintBtn           = document.getElementById("hintBtn"),
          solveModeBtn      = document.getElementById("solveModeBtn"),
          submitSolutionBtn = document.getElementById("submitSolutionBtn"),
          resetBtn          = document.getElementById("resetBtn"),
          bankrollEl        = document.getElementById("bankroll"),
          messageEl         = document.getElementById("message"),
          keyboardEl        = document.getElementById("keyboard"),
          endModal          = document.getElementById("endModal"),
          closeModal        = document.getElementById("closeModal"),
          modalMessageEl    = document.getElementById("modalMessage"),
          highestCashEl     = document.getElementById("highestCash");

    function initKeyboard(){
      keyboardEl.innerHTML = "";
      "QWERTYUIOPASDFGHJKLZXCVBNM".split("").forEach(letter => {
        const btn = document.createElement("div");
        btn.className = "key";
        btn.innerHTML = `
          <span class="cost">\$${letterCosts[letter]}</span>
          <span class="letter">${letter}</span>`;
        btn.onclick = () => handleLetter(letter);
        keyboardEl.appendChild(btn);
      });
    }

    function resetRound(){
      solveMode = false;
      solveAttempts = 0;
      messageEl.textContent = "";
      current = phrases[Math.floor(Math.random()*phrases.length)];
      revealed = Array.from(current.phrase).map(c => c === " " ? " " : "_");
      bankroll = initialBankroll;
      categoryEl.textContent = "Category: " + current.category;
      hintEl.textContent = "";
      submitSolutionBtn.style.display = "none";
      solveModeBtn.textContent = "Solve Puzzle";
      renderPhrase();
      document.querySelectorAll(".key").forEach(k => k.classList.remove("chosen","disabled"));
      hintBtn.disabled = false;
      updateBankroll();
      updateKeys();
    }

    function renderPhrase(){
      phraseEl.innerHTML = "";
      revealed.forEach(ch => {
        const span = document.createElement("span");
        if(ch === " ") {
          span.className = "space-box";
        } else {
          span.className = "letter-box";
          span.textContent = ch;
        }
        phraseEl.appendChild(span);
      });
    }

    function updateBankroll(){
      bankrollEl.innerHTML = `Bankroll: <strong style="color:green">\$${bankroll}</strong>`;
    }

    function updateKeys(){
      document.querySelectorAll(".key").forEach(btn => {
        const l = btn.querySelector(".letter").textContent;
        const cost = letterCosts[l] || 0;
        btn.classList[cost > bankroll || btn.classList.contains("chosen") ? "add" : "remove"]("disabled");
      });
    }

    function handleLetter(letter){
      if(solveMode) return;
      const cost = letterCosts[letter] || 0;
      if(bankroll < cost) return;
      bankroll -= cost; updateBankroll();
      document.querySelectorAll(".key").forEach(b => {
        if(b.querySelector(".letter").textContent === letter) b.classList.add("chosen");
      });
      let hit = false;
      for(let i=0; i<current.phrase.length; i++){
        if(current.phrase[i] === letter && revealed[i] === "_"){
          revealed[i] = letter; hit = true;
        }
      }
      renderPhrase(); updateKeys();
      messageEl.textContent = hit ? "✅ Good guess!" : "❌ No luck!";
    }

    hintBtn.onclick = () => {
      if(bankroll < 200 || solveMode) return;
      bankroll -= 200; updateBankroll();
      hintEl.textContent = "Hint: " + current.hint;
    };

    solveModeBtn.onclick = () => {
      solveMode = !solveMode;
      if(solveMode) enterSolveMode();
      else exitSolveMode();
    };

    function enterSolveMode(){
      solveGuess = Array(current.phrase.length).fill("");
      solveIndex = 0;
      document.querySelectorAll(".key").forEach(k => k.classList.add("disabled"));
      hintBtn.disabled = true;
      renderSolveInputs();
      submitSolutionBtn.style.display = "inline-block";
      solveModeBtn.textContent = "Cancel Solve";
    }

    function exitSolveMode(){
      renderPhrase();
      document.querySelectorAll(".key").forEach(k => k.classList.remove("disabled"));
      hintBtn.disabled = false;
      submitSolutionBtn.style.display = "none";
      solveModeBtn.textContent = "Solve Puzzle";
      updateKeys();
    }

    function renderSolveInputs(){
      phraseEl.innerHTML = "";
      for(let i=0; i<current.phrase.length; i++){
        const ch = current.phrase[i];
        if(ch === " ") {
          const span = document.createElement("span");
          span.className = "space-box";
          phraseEl.appendChild(span);
        } else if(revealed[i] !== "_") {
          const span = document.createElement("span");
          span.className = "letter-box";
          span.textContent = revealed[i];
          phraseEl.appendChild(span);
        } else {
          const inp = document.createElement("input");
          inp.className = "solve-input";
          inp.maxLength = 1;
          inp.value = solveGuess[i] || "";
          inp.dataset.idx = i;
          inp.oninput = e => {
            const v = e.target.value.toUpperCase().replace(/[^A-Z]/, "");
            e.target.value = v;
            solveGuess[i] = v;
            // move focus to next
            let next = i+1;
            while(next < current.phrase.length && (current.phrase[next]===" "|| revealed[next] !== "_")) next++;
            if(next < current.phrase.length){
              const nextInput = phraseEl.querySelector(`input[data-idx="${next}"]`);
              nextInput && nextInput.focus();
            }
          };
          inp.onkeydown = e => {
            if(e.key === "Backspace" && !inp.value){
              // move back
              let prev = i-1;
              while(prev >= 0 && (current.phrase[prev]===" "|| revealed[prev] !== "_")) prev--;
              if(prev >= 0){
                const prevInput = phraseEl.querySelector(`input[data-idx="${prev}"]`);
                prevInput && prevInput.focus();
              }
            }
          };
          phraseEl.appendChild(inp);
        }
      }
      // focus first empty
      const first = phraseEl.querySelector('input');
      first && first.focus();
    }

    submitSolutionBtn.onclick = submitSolution;

    function submitSolution(){
      let guess = "";
      for(let i=0; i<current.phrase.length; i++){
        if(current.phrase[i]===" ") guess += " ";
        else if(revealed[i] !== "_") guess += revealed[i];
        else guess += solveGuess[i] || " ";
      }

      if(guess === current.phrase){
        revealed = Array.from(current.phrase);
        renderPhrase();
        messageEl.textContent = "🎉 Correct!";
        highestCash += bankroll;
        showEndModal("You got it! You banked $" + bankroll + ".");
      } else {
        solveAttempts++;
        if(solveAttempts >= 3){
          revealed = Array.from(current.phrase);
          renderPhrase();
          showEndModal("Too many wrong solves. The answer was: " + current.phrase);
        } else {
          messageEl.textContent = `❌ Incorrect! (${solveAttempts}/3)`;
          solveGuess = solveGuess.map((v,idx) => (revealed[idx]==="_"? "" : v));
          renderSolveInputs();
        }
      }
    }

    function showEndModal(msg){
      modalMessageEl.textContent = msg;
      highestCashEl.textContent = `\$${highestCash}`;
      endModal.style.visibility = "visible";
    }

    closeModal.onclick = () => { endModal.style.visibility = "hidden"; resetRound(); };
    resetBtn.onclick = resetRound;

    // block key handling when modal up
    document.addEventListener("keydown", e => {
      if(endModal.style.visibility === 'visible') return;
      if(/^[a-zA-Z]$/.test(e.key) && solveMode) {
        // mirror typing into focused input
        const input = document.activeElement;
        if(input.tagName === "INPUT") return;
      }
      if(/^[a-zA-Z]$/.test(e.key) && !solveMode) handleLetter(e.key.toUpperCase());
    });

    initKeyboard();
    resetRound();
  </script>

</body>
</html>
